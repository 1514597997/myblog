<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/myblog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/myblog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/myblog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/myblog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/myblog/css/main.css">


<link rel="stylesheet" href="/myblog/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"151459797.github.io","root":"/myblog/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"default"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://151459797.github.io/myblog/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://151459797.github.io/myblog/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/myblog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/myblog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/myblog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://151459797.github.io/myblog/2025/11/06/%E5%90%8E%E7%AB%AF/python/python/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/myblog/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/myblog/2025/11/06/%E5%90%8E%E7%AB%AF/python/python/" class="post-title-link" itemprop="url">python编程语言</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-11-06 20:36:11 / 修改时间：09:12:29" itemprop="dateCreated datePublished" datetime="2025-11-06T20:36:11+08:00">2025-11-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/myblog/categories/%E5%90%8E%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">后端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://151459797.github.io/myblog/2025/11/06/%E5%90%8E%E7%AB%AF/CSharp/EFCore/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/myblog/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/myblog/2025/11/06/%E5%90%8E%E7%AB%AF/CSharp/EFCore/" class="post-title-link" itemprop="url">EFCore</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-11-06 20:36:11 / 修改时间：09:12:29" itemprop="dateCreated datePublished" datetime="2025-11-06T20:36:11+08:00">2025-11-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/myblog/categories/%E5%90%8E%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">后端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="EFCore（Entity-Framework-Core）"><a href="#EFCore（Entity-Framework-Core）" class="headerlink" title="EFCore（Entity Framework Core）"></a>EFCore（Entity Framework Core）</h1><ul>
<li><p>介绍：轻量级、可扩展、开源且跨平台的对象关系映射ORM框架</p>
</li>
<li><p>Entity Framework是上一代版本，而EFCore是专为Core版本设计制作</p>
</li>
<li><p>dotnet指令安装<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet add <span class="keyword">package</span> <span class="title">Microsoft.EntityFrameworkCore </span></span><br></pre></td></tr></table></figure>安装“包管理器控制台工具”<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dotnet add <span class="keyword">package</span> <span class="title">Microsoft.EntityFrameworkCore.Tools</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure>更新“包管理器控制台工具”<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Update-<span class="keyword">Package</span> <span class="title">Microsoft.EntityFrameworkCore.Tools</span></span><br></pre></td></tr></table></figure>验证是否安装<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-<span class="built_in">Help</span> about_EntityFrameworkCore</span><br></pre></td></tr></table></figure></p>
</li>
<li><p>安装对应EFCore的数据库支持，比如mysql，sqlserver</p>
</li>
</ul>
<h1 id="如何运用"><a href="#如何运用" class="headerlink" title="如何运用"></a>如何运用</h1><ul>
<li>1.创建定义模型类</li>
<li>2.创建继承 DbContext类,EF Core的核心类，用于管理实体的生命周期以及与数据库的交互。<ul>
<li>2.1重写OnConfiguring函数，加载数据库配置<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">using</span> Microsoft.EntityFrameworkCore;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> TestWebApplication.yaohao.efcore</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppDbContext</span>:DbContext</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> DbSet&amp;lt;YaoHao&amp;gt; YaoHao &#123; get; set; &#125;<span class="comment">//泛型接口,表示数据库中的一个实体集合（即表）,映射数据库表</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">AppDbContext</span><span class="params">(DbContextOptions&lt;AppDbContext&gt; options)</span></span></span><br><span class="line"><span class="function">        : base(options)</span></span><br><span class="line"><span class="function">        &#123;</span></span><br><span class="line">            <span class="comment">//必须公开具有 DbContextOptions&lt;?&gt; 参数的公共构造函数。才能在web通过依赖注入时启动 </span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="type">void</span> <span class="title">OnConfiguring</span><span class="params">(DbContextOptionsBuilder optionsBuilder)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">//这里根据你的数据库use加载你所需要的数据库配置如: mysql、sqlserver</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="type">void</span> <span class="title">OnModelCreating</span><span class="params">(ModelBuilder modelBuilder)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">//微软推荐这里进行配置实体的映射关系</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>3.迁移工具创建数据库<ul>
<li><p>程序包管理器控制台乱码处理UTF8指令:<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">Console</span>]:<span class="link">:OutputEncoding = [System.Text.Encoding]::UTF8</span></span><br></pre></td></tr></table></figure></p>
</li>
<li><p>3.1 Get-Help about_EntityFrameworkCore -验证安装</p>
<ul>
<li><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">        </span><br><span class="line">                     _/\__</span><br><span class="line">               ---==/    \\</span><br><span class="line">         ___  ___   |<span class="string">.    \</span>|<span class="string">\</span></span><br><span class="line"><span class="string">        </span>|<span class="string"> __</span>||<span class="string"> __</span>|<span class="string">  </span>|<span class="string">  )   \\\</span></span><br><span class="line"><span class="string">        </span>|<span class="string"> _</span>|<span class="string"> </span>|<span class="string"> _</span>|<span class="string">   \_/ </span>|<span class="string">  //</span>|<span class="string">\\</span></span><br><span class="line"><span class="string">        </span>|<span class="string">___</span>||<span class="string">_</span>|<span class="string">       /   \\\/\\</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">TOPIC</span></span><br><span class="line"><span class="string">    about_EntityFrameworkCore</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">SHORT DESCRIPTION</span></span><br><span class="line"><span class="string">    Provides information about the Entity Framework Core Package Manager Console Tools.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&amp;lt;A list of available commands follows, omitted here.&amp;gt;</span></span><br><span class="line"><span class="string">        </span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>3.2 dotnet ef migrations add ‘迁移文件名’ &#x2F;&#x2F;创建一个新的迁移文件，用于描述数据库的初始结构</p>
<ul>
<li>分析模型变化<ul>
<li>如果是第一次运行迁移命令（即数据库尚未创建或迁移历史为空），EF Core 会根据实体模型生成数据库的初始结构。</li>
<li>如果数据库已经存在，EF Core 会检测实体模型的变化（如新增表、修改列、删除关系等）。然后去增量更新迁移文件</li>
</ul>
</li>
<li>生成迁移文件<ul>
<li>EF Core 会生成一个迁移文件，该文件包含两个主要部分<ul>
<li>Up 方法：描述如何将数据库从当前状态迁移到目标状态（即应用模型变化）。</li>
<li>Down 方法：描述如何撤销这些变化（回滚迁移）。</li>
</ul>
</li>
</ul>
</li>
<li>迁移文件命名<ul>
<li>迁移文件的名称由命令中的参数指定 ‘迁移文件名’。通常，迁移文件会存储在项目的 Migrations 文件夹中。</li>
</ul>
</li>
</ul>
</li>
<li><p>3.3 dotnet ef database update</p>
<ul>
<li>用于将迁移文件中定义的变更应用到数据库中，更新数据库的结构。</li>
<li>具体步骤<ul>
<li>读取迁移历史<ul>
<li>EF Core 会检查数据库中的 __EFMigrationsHistory 表，了解当前数据库已经应用了哪些迁移。</li>
</ul>
</li>
<li>应用未应用的迁移<ul>
<li>EF Core 会找到尚未应用到数据库的迁移文件，并按照顺序执行这些迁移文件中的 Up 方法，从而更新数据库结构。</li>
</ul>
</li>
<li>记录迁移历史<ul>
<li>每次应用迁移后，EF Core 会在 __EFMigrationsHistory 表中记录迁移的名称和时间戳，以便后续跟踪哪些迁移已经应用。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h1><ul>
<li>efcore默认是有2个级别缓存。1、2级缓存</li>
<li>1级缓存微软默认开启，2级缓存需手动开启</li>
</ul>
<h1 id="运行链路"><a href="#运行链路" class="headerlink" title="运行链路"></a>运行链路</h1><ul>
<li>1.查询<ul>
<li>1.检查本地缓存<ul>
<li>在 DbContext 的 ChangeTracker 中查找已跟踪的实体</li>
<li>如果实体已被加载且未被标记为 Deleted，直接返回缓存副本</li>
</ul>
</li>
<li>2.生成 SQL <ul>
<li>若缓存未命中，构建参数化查询</li>
<li>根据主键值生成高效的 SELECT TOP(1) 语句。</li>
</ul>
</li>
<li>3.执行 SQL<ul>
<li>通过 ADO.NET 发送查询到数据库</li>
<li>使用连接池复用数据库连接。</li>
</ul>
</li>
<li>4.实体化结果<ul>
<li>将数据库返回的数据转换为 Product 对象</li>
<li>调用实体构造函数并填充属性。</li>
</ul>
</li>
<li>5.跟踪实体状态<ul>
<li>将实体添加到 ChangeTracker</li>
<li>状态标记为 Unchanged，后续修改会被跟踪。</li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://151459797.github.io/myblog/2025/11/06/%E5%90%8E%E7%AB%AF/CSharp/CSharp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/myblog/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/myblog/2025/11/06/%E5%90%8E%E7%AB%AF/CSharp/CSharp/" class="post-title-link" itemprop="url">C#编程语言</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-11-06 20:36:11 / 修改时间：09:12:29" itemprop="dateCreated datePublished" datetime="2025-11-06T20:36:11+08:00">2025-11-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/myblog/categories/%E5%90%8E%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">后端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="C"><a href="#C" class="headerlink" title="C#"></a>C#</h1><ul>
<li>基于.net的面向对象开发语言</li>
</ul>
<h1 id="NETCore与-NETFramework"><a href="#NETCore与-NETFramework" class="headerlink" title=".NETCore与.NETFramework"></a>.NETCore与.NETFramework</h1><ul>
<li>1.NET Framework<ul>
<li>微软开发的运行时环境，主要用于 Windows 平台。它依赖于 Windows 操作系统，与 Windows 系统深度集成。微软已停止更新</li>
</ul>
</li>
<li>2.NET Core <ul>
<li>是跨平台的运行时环境，支持 Windows、Linux 和 macOS 等多种操作系统。它通过抽象层来屏蔽不同操作系统之间的差异，使得应用程序可以在不同平台上运行。</li>
</ul>
</li>
</ul>
<h1 id="编程环境"><a href="#编程环境" class="headerlink" title="编程环境"></a>编程环境</h1><ul>
<li>1.安装.NET Core(Core自带了SDK和runtime)<ul>
<li>查看是否安装版本指令：dotnet -h（显示相关版本号）</li>
</ul>
</li>
<li>2.准备开发工具Ide、VisualStudio(微软官方开发工具，更适合C#)<ul>
<li>以下是各个版本的区别</li>
<li>isual Studio Community：这是一个免费的版本，适用于个人开发者、学术研究、教室学习和参与开源项目。它提供了完整的集成开发环境，支持Windows桌面、通用Windows应用、Web（ASP.NET）、Office 365、业务应用程序、Azure Stack、C++跨平台库开发、Python、Node.js、.NET Core和Docker工具。</li>
<li>Visual Studio Professional：这个版本适用于专业开发人员和小型团队，提供了更高级的调试和诊断工具、测试工具、跨平台开发支持和协作工具。它还包括PowerPoint情节提要、代码评审、任务暂停&#x2F;继续和团队资源管理器（第三方开发工具支持）等功能。</li>
<li>Visual Studio Enterprise：这是最全面的版本，提供了端到端的解决方案，以满足大型团队的严苛质量和规模需求。它包括所有Professional版本的功能，以及更高级的测试工具、协作工具和功能，如Visual Studio Live Share。</li>
</ul>
</li>
</ul>
<h1 id="编译与执行"><a href="#编译与执行" class="headerlink" title="编译与执行"></a>编译与执行</h1><ul>
<li>C#代码首先被编译成中间语言（IL），然后在.NET运行时（CLR）中进行即时编译（JIT） </li>
<li>和java类型预编译运行类似，但C#还会在运行时再即时编译运行</li>
<li>C#也拥有垃圾自动回收机制，但支持底层开发人员手动操作回收垃圾。</li>
</ul>
<h1 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h1><ul>
<li>依赖项:应用编译、构建、开发时的依赖项SDK</li>
<li>Properties：.netCore项目的存放的配置信息，通过.json格式存放<ul>
<li>launchSettings.json:.netCore应用标准配置文件，包含环境变量、ip端口等</li>
</ul>
</li>
<li>wwwroot：网站根目录，存放前端静态资源，html、js、图片等。</li>
<li>Program.cs:.netCore应用的main方法，是项目启动的入口，负责配置和启动程序</li>
<li>Startup类:在.net5之后被废弃（原来的项目启动入口）</li>
</ul>
<h1 id="net-Web项目启动流程"><a href="#net-Web项目启动流程" class="headerlink" title=".net Web项目启动流程"></a>.net Web项目启动流程</h1><ul>
<li><p>1.运行时初始化</p>
<ul>
<li>1.1 加载.net进程，管理内存、执行代码、处理异常等核心功能</li>
<li>2.1 加载程序集：运行时加载项目中引用的程序集（如依赖的库文件），并解析依赖关系。</li>
<li>3.1 初始化配置系统：运行时会解析配置文件（如appsettings.json），并初始化配置系统。</li>
</ul>
</li>
<li><p>2.执行Program文件、文件内：1.构建宿主（Host）2. 配置服务 3. 构建应用程序 4.配置中间件管道 5.启动应用程序</p>
</li>
<li><p>3.初始化宿主（Host）WebApplication.CreateBuilder(args)</p>
<ul>
<li>3.1 Program代码中:WebApplication.CreateBuilder(args);宿主构建的起点。</li>
<li>3.2 CreateBuilder方法会初始化一个宿主构建器（HostBuilder），并配置默认的服务、配置源和日志提供者。<ul>
<li>3.2.1 加载默认的配置文件（如appsettings.json）。</li>
<li>3.2.2 初始化依赖注入容器,Ioc容器依赖注入</li>
<li>3.2.3 配置日志系统。</li>
<li>3.2.4 宿主生命周期管理服务：用于管理应用程序的启动和关闭过程。</li>
<li>3.2.5 其他基础服务：如IOptions、IConfiguration等。</li>
</ul>
</li>
</ul>
</li>
<li><p>4 添加服务</p>
<ul>
<li>4.1 builder.Services.AddControllers();微软配置默认服务:注册了MVC控制器。</li>
<li>4.2 builder.Services.AddEndpointsApiExplorer();微软配置默认服务:注册了端点API资源，这是Swagger&#x2F;OpenAPI支持的基础。</li>
<li>4.3 builder.Services.AddSwaggerGen();注册了Swagger生成器，用于生成OpenAPI文档。</li>
</ul>
</li>
<li><p>5 构建宿主（Host）</p>
<ul>
<li>5.4.1 Program执行到：var app &#x3D; builder.Build();这一行代码完成了宿主的构建过程。</li>
<li>5.4.2 Build方法内做的事情<ul>
<li>5.4.2.1 构建依赖注入容器。</li>
<li>5.4.2.2 为后续项目根据自己需求，微软会默认初始化一个空的中间件管道。</li>
<li>5.4.2.3 初始化日志系统和其他基础设施。</li>
</ul>
</li>
</ul>
</li>
<li><p>6.构配置中间件管道</p>
<ul>
<li>根据项目需求增加自定义管道</li>
<li>以下是微软默认提供可自主配置的管道</li>
<li>异常处理中间件<ul>
<li><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseDeveloperExceptionPage()<span class="comment">; </span></span><br></pre></td></tr></table></figure>在开发环境中显示详细的错误信息。</li>
<li><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.UseEndpoints(</span><br><span class="line">    endpoints <span class="operator">=</span>&gt;&#123;</span><br><span class="line">        endpoints.MapControllers()<span class="comment">;</span></span><br><span class="line">        endpoints.MapRazorPages()<span class="comment">;</span></span><br><span class="line">    &#125;)<span class="comment">;</span></span><br></pre></td></tr></table></figure> 捕获异常并返回友好的错误页面或错误信息。</li>
</ul>
</li>
<li>身份验证和授权<ul>
<li><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseAuthentication()<span class="comment">;</span></span><br></pre></td></tr></table></figure> 提供身份验证支持，如JWT、Cookie等。</li>
<li><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseAuthorization()<span class="comment">;</span></span><br></pre></td></tr></table></figure> 提供授权支持，用于检查用户权限。</li>
</ul>
</li>
<li>跨域资源共享（CORS）<ul>
<li><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseCors()<span class="comment">;</span></span><br></pre></td></tr></table></figure> 配置跨域资源共享，允许或限制外部域对API的访问。</li>
</ul>
</li>
<li>静态文件服务<ul>
<li><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseStaticFiles()<span class="comment">;</span></span><br></pre></td></tr></table></figure> 提供静态文件（如HTML、CSS、JavaScript）的访问支持。</li>
</ul>
</li>
<li>路由和端点<ul>
<li><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseRouting()<span class="comment">;</span></span><br></pre></td></tr></table></figure> 定义请求的路由规则。</li>
</ul>
</li>
<li>HTTPS重定向<ul>
<li><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseHttpsRedirection()<span class="comment">;</span></span><br></pre></td></tr></table></figure> 将所有HTTP请求重定向到HTTPS。</li>
</ul>
</li>
<li>压缩响应<ul>
<li><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseResponseCompression()<span class="comment">;</span></span><br></pre></td></tr></table></figure> 对响应内容进行压缩，减少传输数据量。</li>
</ul>
</li>
<li>请求本地化<ul>
<li><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseRequestLocalization()<span class="comment">;</span></span><br></pre></td></tr></table></figure> 提供本地化支持，根据用户语言偏好返回本地化内容。</li>
</ul>
</li>
<li>会话管理<ul>
<li><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseSession()<span class="comment">;</span></span><br></pre></td></tr></table></figure> 管理用户会话，存储用户会话数据。</li>
</ul>
</li>
<li>WebSockets支持<ul>
<li><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseWebSockets()<span class="comment">;</span></span><br></pre></td></tr></table></figure> 启用WebSockets协议，支持实时通信。</li>
</ul>
</li>
<li>健康检查<ul>
<li><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseHealthChecks(<span class="string">&quot;/health&quot;</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure> 检查应用程序及其依赖项的运行状态。</li>
</ul>
</li>
<li>URL重写<ul>
<li><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">app</span><span class="selector-class">.UseRewriter</span>(</span><br><span class="line">    new <span class="built_in">RewriteOptions</span>().<span class="built_in">AddRedirect</span>(<span class="string">&quot;old-path&quot;</span>, <span class="string">&quot;new-path&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure> 重写URL或重定向请求，用于SEO优化或路由调整。</li>
</ul>
</li>
<li>日志记录<ul>
<li><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseLogging()<span class="comment">;</span></span><br></pre></td></tr></table></figure> 记录请求和响应的详细信息，用于调试和监控。</li>
</ul>
</li>
<li>单页应用程序（SPA）支持<ul>
<li><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.UseSpa(spa <span class="operator">=</span>&gt;&#123;</span><br><span class="line">    spa.Options.SourcePath <span class="operator">=</span> <span class="string">&quot;ClientApp&quot;</span><span class="comment">;</span></span><br><span class="line">&#125;)<span class="comment">;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>其他中间件<ul>
<li><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseCookiePolicy()<span class="comment">;</span></span><br></pre></td></tr></table></figure> 管理Cookie策略，确保Cookie的安全性。</li>
<li><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseResponseCaching()<span class="comment">;</span></span><br></pre></td></tr></table></figure> 提供响应缓存支持，提高性能。</li>
</ul>
</li>
</ul>
</li>
<li><p>7.启动应用程序</p>
<ul>
<li>7.1 app.Run();<ul>
<li>7.1.1 启动Kestrel服务器，且开始根据配置的端口监听请求</li>
<li>7.1.2 运行中间件管道：HTTP请求会按照中间件管道中配置的顺序被处理。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="委托"><a href="#委托" class="headerlink" title="委托"></a>委托</h1><ul>
<li>C#中实现方法引用和回调机制的核心类型，类似于Java中的函数式接口</li>
<li>定义：委托是一种类型安全的函数指针，它定义了方法的签名（参数和返回类型），可以指向任何符合签名的方法。</li>
<li>核心作用：<ul>
<li>将方法作为参数传递（如回调）。</li>
<li>实现事件驱动编程（如按钮点击事件）。</li>
<li>解耦调用方与具体实现（如插件架构）。</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://151459797.github.io/myblog/2025/11/06/%E5%90%8E%E7%AB%AF/JAVA/SpringCloud/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/myblog/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/myblog/2025/11/06/%E5%90%8E%E7%AB%AF/JAVA/SpringCloud/" class="post-title-link" itemprop="url">SpringCloud</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-11-06 20:36:10 / 修改时间：09:12:29" itemprop="dateCreated datePublished" datetime="2025-11-06T20:36:10+08:00">2025-11-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/myblog/categories/%E5%90%8E%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">后端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="SpringCloud"><a href="#SpringCloud" class="headerlink" title="SpringCloud"></a>SpringCloud</h1><ul>
<li>SpringCloud是基于SpringBoot的集合框架，主要用与开发分布式服务器。</li>
<li><ol>
<li>Spring Cloud 简介</li>
</ol>
<ul>
<li>Spring Cloud 是一系列框架的有序集合，利用 Spring Boot 的开发便利性，简化了分布式系统基础设施的开发。它整合了 Netflix 等公司的成熟框架，提供了服务发现注册、配置中心、消息总线、负载均衡、断路器等功能，是一套简单易用、易部署和易维护的分布式系统开发工具包。</li>
</ul>
</li>
<li><ol start="2">
<li>Spring Cloud 特点</li>
</ol>
<ul>
<li>集成性：深度集成 Netflix 开源组件，提供完整且经过实践检验的微服务解决方案。</li>
<li>易用性：遵循 Spring Boot 开发风格，提供丰富文档和社区支持。</li>
<li>灵活性：可根据项目需求选择适合的组件进行集成。</li>
<li>扩展性：支持水平或垂直扩展，适应业务发展。</li>
<li>可靠性：通过熔断器、负载均衡等机制，确保系统稳定性和可靠性。</li>
</ul>
</li>
<li><ol start="3">
<li>Spring Cloud 核心组件与原理</li>
</ol>
<ul>
<li>3.1 服务注册与发现<ul>
<li>服务提供者启动时，会将自己的网络地址、端口号等信息注册到注册中心（如 Eureka、Consul 或 Zookeeper 等），服务消费者通过注册中心查询所需服务的信息，实现服务的动态发现。</li>
</ul>
</li>
<li>3.2 负载均衡<ul>
<li>Spring Cloud 通过集成 Ribbon 或 Feign 等组件来实现负载均衡，根据一定的算法选择合适的服务实例进行请求转发。</li>
</ul>
</li>
<li>3.3 容错处理<ul>
<li>引入熔断器模式（如 Hystrix），在服务调用出现连续失败时，暂时停止对该服务的调用，避免进一步的资源浪费和性能下降。</li>
</ul>
</li>
<li>3.4 服务网关<ul>
<li>服务网关（如 Zuul 或 Spring Cloud Gateway）作为微服务架构的入口，负责处理外部请求并转发到内部的服务实例上，支持动态路由、请求过滤、安全认证等功能。</li>
</ul>
</li>
<li>3.5 配置管理<ul>
<li>Spring Cloud Config 将配置信息存储在外部的配置中心（如 Git 仓库、数据库等），各个微服务在启动时从配置中心获取所需的配置信息，支持配置的版本控制和动态刷新功能</li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://151459797.github.io/myblog/2025/11/06/%E5%90%8E%E7%AB%AF/JAVA/Mybatis%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/myblog/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/myblog/2025/11/06/%E5%90%8E%E7%AB%AF/JAVA/Mybatis%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD/" class="post-title-link" itemprop="url">Mybatis延迟加载(懒加载)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-11-06 20:36:10 / 修改时间：23:00:29" itemprop="dateCreated datePublished" datetime="2025-11-06T20:36:10+08:00">2025-11-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/myblog/categories/%E5%90%8E%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">后端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li>在Mybatis中使用多表联查时，可能会有不需要的数据被相关查询，这时就可以使用该技术优化节省查询次数。<ul>
<li>列如查询订单信息，默认关联用户、部门、岗位相关信息，可设置只有需要获取时才查询用户、部门、岗位相关信息</li>
</ul>
</li>
</ul>
<h2>使用示例:</h2>

<ul>
<li>先mybaits-config.xml全局配置懒加载<ul>
<li><pre><code class="xml">
</code></pre>
</li>
</ul>
<p>  &#x2F;&#x2F;mybatis-config.xml 开启懒加载<br>  <configuration><br>  <!-- 设置mybatis全局属性 --><br>  <settings><br>      <!--延迟加载 --><br>      <!-- 懒加载  避免在加载一个属性时就加载所有属性--><br>      <setting name="lazyLoadingEnabled" value="true" /><br>      <!-- 积极加载  只有访问在访问到某个属性才执行相关sql --><br>       <!--3.4.1版本之前默认是true，之后默认是false--><br>      <setting name="aggressiveLazyLoading" value="false" /><br>  </settings><br>  </configuration><br>  <figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">- 在Mapper文件中定义相关依赖sql和结构</span></span><br><span class="line"><span class="language-xml">- 部门Mapper:</span></span><br><span class="line"><span class="language-xml">    - ```xml</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 通用查询映射结果 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.user.entity.Department&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;code&quot;</span> <span class="attr">property</span>=<span class="string">&quot;code&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;manager_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;managerId&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;parent_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;parentId&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;remark&quot;</span> <span class="attr">property</span>=<span class="string">&quot;remark&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;status&quot;</span> <span class="attr">property</span>=<span class="string">&quot;status&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createTime&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;update_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;updateTime&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!-- 懒加载用户信息 --&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!-- 关联用户表 --&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;users&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;com.user.mapper.UserMapper.queryUserByDepartmentId&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 查询部门相关所有用户映射结果 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;UserAndDepartment&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.user.entity.Department&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;users&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.user.entity.User&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;u_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="comment">&lt;!-- 用户密码</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">            &lt;result column=&quot;password&quot; property=&quot;password&quot; /&gt;</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">            --&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;u_status&quot;</span> <span class="attr">property</span>=<span class="string">&quot;status&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;u_create_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createTime&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;u_update_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;updateTime&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;departmentId&quot;</span> <span class="attr">property</span>=<span class="string">&quot;departmentId&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 根据id获取部门 懒加载用户 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDepartmentMaybeUsers&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        select * from department where id = #</span><span class="template-variable">&#123;id&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
</li>
<li>用户Mapper:<ul>
<li><pre><code class="xml">
</code></pre>
</li>
</ul>
  <!-- 通用查询结果列 -->
  <sql id="Base_Column_List">
      id, username, password, email, phone, status, create_time, update_time
  </sql>

  <select id="queryUserByDepartmentId" resultType="com.user.entity.User" >
      select <include refid="Base_Column_List"></include>  from user u where  u.departmentId=#{departmentId}
  </select>
  <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- 服务调用示例:</span><br><span class="line">    - ```xml</span><br><span class="line">    <span class="meta">@ApiOperation(value = <span class="string">&quot;获取部门 懒加载用户信息&quot;</span>, notes = <span class="string">&quot;根据ID查询部门和懒加载用户信息&quot;</span>)</span></span><br><span class="line">    <span class="meta">@GetMapping(<span class="string">&quot;/getDepartmentMaybeUsers/&#123;id&#125;&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> Department getDepartmentMaybeUsers(<span class="meta">@PathVariable</span> String id) &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;开始获取部门信息和懒加载用户&quot;</span>);</span><br><span class="line">        Department department = departmentService.getDepartmentMaybeUsers(id);</span><br><span class="line"><span class="comment">//      java程序检测是否有使用懒加载相关逻辑</span></span><br><span class="line"><span class="comment">//        for (User user: department.getUsers()) &#123;</span></span><br><span class="line"><span class="comment">//            System.out.println(user);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        logger.info(<span class="string">&quot;结束获取部门信息和懒加载用户&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> department;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://151459797.github.io/myblog/2025/11/06/%E5%90%8E%E7%AB%AF/JAVA/SpringBoot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/myblog/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/myblog/2025/11/06/%E5%90%8E%E7%AB%AF/JAVA/SpringBoot/" class="post-title-link" itemprop="url">SpringBoot</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-11-06 20:36:10 / 修改时间：09:12:29" itemprop="dateCreated datePublished" datetime="2025-11-06T20:36:10+08:00">2025-11-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/myblog/categories/%E5%90%8E%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">后端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="SpringBoot官网"><a href="#SpringBoot官网" class="headerlink" title="SpringBoot官网"></a>SpringBoot<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.0.1.RELEASE/reference/htmlsingle/?utm_source=blog0716">官网</a></h1><ul>
<li>基于Spring框架的应用开发框架,SpringBoot继承了Spring框架的优秀特性</li>
<li>独立运行的Spring应用程序：Spring Boot允许开发者创建独立运行的Spring应用程序，无需部署到外部应用服务器</li>
<li>内嵌Servlet容器：Spring Boot默认内置了Tomcat、Jetty或Undertow等Servlet容器，开发者可以根据需要选择合适的容器</li>
<li>约定优于配置：当用户没有手动设置相关配置时，Spring Boot会根据应用程序的依赖和默认规则自动创建和配置Bean。</li>
<li>简化依赖管理：通过“starter”项目对象模型（POMs），Spring Boot简化了Maven配置</li>
<li>无需XML配置：Spring Boot采用注解和JavaConfig的方式进行配置，避免了繁琐的XML配置</li>
<li>Spring Boot 是构建微服务的理想选择，结合 Spring Cloud 可以轻松实现服务发现、负载均衡、熔断器等功能。</li>
<li>Spring Boot Actuator 监控<ul>
<li>用于监控和管理应用程序的模块</li>
<li>健康检查：通过 &#x2F;actuator&#x2F;health 端点检查应用程序的健康状态</li>
<li>性能指标：通过 &#x2F;actuator&#x2F;metrics 端点获取应用程序的性能指标</li>
<li>环境信息：查看应用程序的环境配置</li>
<li>日志级别管理：动态调整日志级别</li>
<li>自定义端点：开发者可以自定义监控端点</li>
</ul>
</li>
<li>外部化配置（Externalized Configuration）<ul>
<li>Spring Boot 支持通过多种方式加载配置信息，包括：</li>
<li>配置文件：如 application.properties 或 application.yml。</li>
<li>环境变量：可以通过环境变量覆盖配置文件中的值。</li>
<li>命令行参数：启动时通过命令行参数传递配置。</li>
<li>配置文件按环境分离：支持为不同环境（如开发、测试、生产）创建不同的配置文件，如 application-dev.properties</li>
</ul>
</li>
<li>启动器（Starters）<ul>
<li>Spring Boot 提供了一系列的“启动器”（Starter Dependencies），简化了依赖管理。常见的启动器包括：</li>
<li>spring-boot-starter-web：用于构建 Web 应用。</li>
<li>spring-boot-starter-data-jpa：用于 JPA 数据访问。</li>
<li>spring-boot-starter-test：用于测试。</li>
<li>spring-boot-starter-security：用于安全和认证。</li>
</ul>
</li>
<li>性能优化<ul>
<li>异步处理：通过 @Async 注解实现异步方法调用。</li>
<li>缓存支持：集成 Redis 或 Ehcache 提高性能。</li>
<li>连接池：使用 HikariCP 等高性能连接池。</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://151459797.github.io/myblog/2025/11/06/%E5%90%8E%E7%AB%AF/JAVA/SpinrgMVC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/myblog/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/myblog/2025/11/06/%E5%90%8E%E7%AB%AF/JAVA/SpinrgMVC/" class="post-title-link" itemprop="url">SrpingMVC</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-11-06 20:36:10 / 修改时间：20:41:34" itemprop="dateCreated datePublished" datetime="2025-11-06T20:36:10+08:00">2025-11-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/myblog/categories/%E5%90%8E%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">后端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li>SpringMVC（Spring Model View Control）<ul>
<li>基于 Java 和 Spring 的 Web 框架</li>
<li>Model（模型）：负责应用程序的业务逻辑和数据。</li>
<li>View（视图）：负责用户界面和用户交互。</li>
<li>Controller（控制器）：作为模型和视图之间的桥梁。<ul>
<li>通常在SpringMVC使用元注解标注<ul>
<li>@Controller:标记一个类为 Spring MVC 的控制器</li>
<li>@RestController:@Controller 和 @ResponseBody的组合创建 RESTful 风格的控制器,其所有方法的返回值都将直接作为响应体返回</li>
<li>@RequestMapping:用于将 HTTP 请求映射到控制器方法。</li>
<li>@GetMapping、@PostMapping、@PutMapping、@DeleteMapping:@RequestMapping 的特定 HTTP 方法版本，分别用于处理 GET、POST、PUT 和 DELETE 请求</li>
<li>@RequestParam:用于将请求参数绑定到控制器方法的参数上</li>
<li>@PathVariable:将 URL 中的一部分作为控制器方法的参数</li>
<li>@RequestBody:将请求体的内容绑定到控制器方法的参数上，通常用于处理 JSON 或 XML 数据</li>
<li>@ResponseBody:将控制器方法的返回值直接写入 HTTP 响应体中</li>
<li>@ModelAttribute:将请求参数绑定到一个对象上，或者将对象添加到模型中</li>
<li>@ExceptionHandler: 处理控制器中出现的异常</li>
</ul>
</li>
<li>AbstractController:Spring MVC 框架提供的一个抽象类<ul>
<li>定义控制器的基本行为：它定义了控制器的基本接口和行为模式，例如请求处理、响应生成等。</li>
<li>提供请求处理的生命周期管理：它管理控制器的初始化、销毁等生命周期事件。</li>
<li>支持多种请求处理方式：它允许通过重写方法来实现不同的请求处理逻辑，例如处理 GET 请求、POST 请求等。</li>
<li>提供请求映射功能：通过 handleRequest 方法，它能够将 HTTP 请求映射到具体的处理逻辑上。</li>
<li>可继承重写以下内容：<ul>
<li>handleRequestInternal(HttpServletRequest request, HttpServletResponse response)<ul>
<li>这是 AbstractController 中最核心的方法之一，它用于处理具体的请求。通过重写这个方法，可以实现以下功能：</li>
<li>自定义请求处理逻辑：根据请求的类型（如 GET、POST）和内容，实现特定的业务逻辑。</li>
<li>生成响应内容：可以生成 HTML 页面、JSON 数据、XML 数据等作为响应返回给客户端。</li>
<li>控制请求的流向：例如，根据请求的参数或用户权限，决定是直接返回响应还是转发到其他控制器。</li>
</ul>
</li>
<li>afterPropertiesSet()<ul>
<li>这是一个初始化回调方法，继承自 InitializingBean 接口。通过重写这个方法，可以在控制器初始化完成后执行一些初始化操作，例如：加载配置文件：加载业务相关的配置信息。</li>
<li>初始化资源：初始化数据库连接、缓存等资源。</li>
<li>校验配置：检查配置是否正确，确保控制器在启动时处于正确的状态。</li>
</ul>
</li>
<li>destroy()<ul>
<li>这是一个销毁回调方法，继承自 DisposableBean 接口。通过重写这个方法，可以在控制器销毁时执行一些清理工作，例如：</li>
<li>释放资源：关闭数据库连接、释放文件句柄等。</li>
<li>清理缓存：清除控制器中使用的缓存数据，避免内存泄漏。</li>
</ul>
</li>
<li>supportsMethod(String method)<ul>
<li>这个方法用于判断控制器是否支持某种 HTTP 方法（如 GET、POST、PUT 等）。通过重写这个方法，可以自定义控制器支持的 HTTP 方法，例如：</li>
<li>限制请求方法：只允许特定的 HTTP 方法访问控制器，增强安全性。</li>
<li>动态支持方法：根据某些条件动态决定支持的 HTTP 方法。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>总体工作流程<ul>
<li>DispatcherServlet：前端控制器，负责接收所有 HTTP 请求并分发给合适的处理器。</li>
<li>HandlerMapping：确定哪个 Controller 处理当前请求。</li>
<li>HandlerAdapter：适配不同类型的处理器（Handler），确保它们能够被正确调用。</li>
<li>Controller：处理具体的业务逻辑，通常是一个带有 @Controller 注解的类。</li>
<li>ModelAndView：封装模型数据和视图名称。</li>
<li>ViewResolver：解析视图名称，返回实际的 View 对象。</li>
<li>View：负责将模型数据渲染为最终的 HTML 页面。</li>
</ul>
</li>
</ul>
</li>
</ul>
<style>
.markmap {
  --markmap-text-color: #faf9f8;
}
</style>

<h1 id="思维导图未加载就请刷新网页"><a href="#思维导图未加载就请刷新网页" class="headerlink" title="思维导图未加载就请刷新网页"></a>思维导图未加载就请刷新网页</h1>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://151459797.github.io/myblog/2025/11/06/%E5%90%8E%E7%AB%AF/JAVA/Mybatis%E7%BC%93%E5%AD%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/myblog/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/myblog/2025/11/06/%E5%90%8E%E7%AB%AF/JAVA/Mybatis%E7%BC%93%E5%AD%98/" class="post-title-link" itemprop="url">Mybatis缓存</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-11-06 20:36:10 / 修改时间：09:12:29" itemprop="dateCreated datePublished" datetime="2025-11-06T20:36:10+08:00">2025-11-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/myblog/categories/%E5%90%8E%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">后端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li><p>理解1、2、3级缓存和实战 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/cxuanBlog/p/11324034.html">原理参考文档</a> <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/23650823064">实战参考文档</a></p>
</li>
<li><p>缓存执行过程</p>
<ul>
<li>3级缓存（自定义应用级缓存）：redis\Ehcache<ul>
<li>因为二级缓存和一级缓存只适合单机单服务器的情况，针对集群或分布式就提供了自定义应用级缓存的方式解决</li>
<li>Ehcache是进程内缓存（JVM堆内存&#x2F;堆外内存+本地磁盘）很多缓存都存储在本地服务器中，所以更适合本地单机的服务器用作2级缓存</li>
<li>redis虽然本地没有Ehcache响应，但独立内存数据库，跨进程共享，且redis本身就支持分布式、哨兵等，所以更适合分布式和集群的缓存</li>
</ul>
</li>
<li>2级缓存:同一Mapper共享<ul>
<li>2级缓存相关配置参考说明 <a target="_blank" rel="noopener" href="https://mybatis.net.cn/sqlmap-xml.html#cache">官服文档</a></li>
</ul>
</li>
<li>1级缓存:同一session时</li>
<li>最终db数据库执行sql<table><tr><th>缓存级别</th><th>作用域</th><th>生命周期</th><th>开启方式</th></tr><tr><td>一级缓存</td><td><span>SqlSession</span>级别</td><td>会话级（请求级）</td><td>默认开启</td></tr><tr><td>二级缓存</td><td>Mapper级别</td><td>应用级（跨会话）</td><td>需显式配置</td></tr><tr><td>三级缓存</td><td>应用集群级</td><td>分布式环境</td><td>需集成第三方</td></tr></table></li>
</ul>
</li>
<li><p>1级缓存 session级别缓存</p>
<ul>
<li>在同一个session中执行sql后会缓存执行的sql和结果</li>
<li><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">try(SqlSession <span class="keyword">session</span> = sqlSessionFactory.openSession())&#123;</span><br><span class="line">    UserMapper mapper =  <span class="keyword">session</span>.getMapper(UserMapper.<span class="keyword">class</span>);</span><br><span class="line">    <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;查询时间1开始:&quot;+<span class="keyword">System</span>.currentTimeMillis());</span><br><span class="line">    List&lt;<span class="keyword">User</span>&gt; userList = mapper.getUserList();</span><br><span class="line">    <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;查询时间1结束:&quot;+<span class="keyword">System</span>.currentTimeMillis());</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">User</span> <span class="keyword">user</span> : userList) &#123;</span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(<span class="keyword">user</span>.getId()+&quot;:&quot;+<span class="keyword">user</span>.getUsername());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;查询时间2开始:&quot;+<span class="keyword">System</span>.currentTimeMillis());</span><br><span class="line">    List&lt;<span class="keyword">User</span>&gt; userList2 = mapper.getUserList();</span><br><span class="line">    <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;查询时间2结束:&quot;+<span class="keyword">System</span>.currentTimeMillis());</span><br><span class="line">    <span class="keyword">if</span>(userList==userList2)&#123;</span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;缓存命中&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//执行结果</span><br><span class="line">//查询时间<span class="number">1</span>开始:<span class="number">1753322770960</span></span><br><span class="line">//查询时间<span class="number">1</span>结束:<span class="number">1753322771130</span></span><br><span class="line">//查询时间<span class="number">2</span>开始:<span class="number">1753322771135</span></span><br><span class="line">//查询时间<span class="number">2</span>结束:<span class="number">1753322771135</span></span><br><span class="line">//缓存命中</span><br><span class="line">    </span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>2级缓存 Mapper级别的共享缓存</p>
<ul>
<li>Step1：全局启用缓存  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Step2：Mapper文件声明缓存  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.user.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span></span></span><br><span class="line"><span class="tag">            <span class="attr">eviction</span>=<span class="string">&quot;FIFO&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">flushInterval</span>=<span class="string">&quot;600000&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">size</span>=<span class="string">&quot;512&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">readOnly</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 通用查询结果列 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;Base_Column_List&quot;</span>&gt;</span></span><br><span class="line">        id, username, password, email, phone, status, create_time, update_time</span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.user.entity.User&quot;</span> <span class="attr">useCache</span>=<span class="string">&quot;true&quot;</span> &gt;</span></span><br><span class="line">        select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;Base_Column_List&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span>  from user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>测试代码  <figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">List&lt;User&gt; userList;</span><br><span class="line">List&lt;User&gt; userList2;</span><br><span class="line"><span class="keyword">try</span>(SqlSession session = sqlSessionFactory.openSession())&#123;</span><br><span class="line">    System.out.<span class="keyword">println</span>(<span class="string">&quot;session&quot;</span>);</span><br><span class="line">    UserMapper mapper =  session.getMapper(UserMapper.<span class="keyword">class</span>);</span><br><span class="line">    System.out.<span class="keyword">println</span>(<span class="string">&quot;查询时间1开始:&quot;</span>+System.currentTimeMillis());</span><br><span class="line">    userList = mapper.getUserList();</span><br><span class="line">    System.out.<span class="keyword">println</span>(<span class="string">&quot;userList长度:&quot;</span>+userList.<span class="keyword">size</span>());</span><br><span class="line">    System.out.<span class="keyword">println</span>(<span class="string">&quot;查询时间1结束:&quot;</span>+System.currentTimeMillis());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">try</span>(SqlSession session2 = sqlSessionFactory.openSession())&#123;</span><br><span class="line">    System.out.<span class="keyword">println</span>(<span class="string">&quot;session2&quot;</span>);</span><br><span class="line">    UserMapper mapper =  session2.getMapper(UserMapper.<span class="keyword">class</span>);</span><br><span class="line">    System.out.<span class="keyword">println</span>(<span class="string">&quot;查询时间2开始:&quot;</span>+System.currentTimeMillis());</span><br><span class="line">    userList2 = mapper.getUserList();</span><br><span class="line">    System.out.<span class="keyword">println</span>(<span class="string">&quot;userList2长度:&quot;</span>+userList2.<span class="keyword">size</span>());</span><br><span class="line">    System.out.<span class="keyword">println</span>(<span class="string">&quot;查询时间2结束:&quot;</span>+System.currentTimeMillis());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (userList==userList2)&#123;</span><br><span class="line">    System.out.<span class="keyword">println</span>(<span class="string">&quot;二级缓存命中&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//测试结果</span></span><br><span class="line"><span class="comment">//session</span></span><br><span class="line"><span class="comment">//查询时间1开始:1753328802014</span></span><br><span class="line"><span class="comment">//userList长度:72</span></span><br><span class="line"><span class="comment">//查询时间1结束:1753328802125</span></span><br><span class="line"><span class="comment">//session2</span></span><br><span class="line"><span class="comment">//查询时间2开始:1753328802126</span></span><br><span class="line"><span class="comment">//userList2长度:72</span></span><br><span class="line"><span class="comment">//查询时间2结束:1753328802126</span></span><br><span class="line"><span class="comment">//二级缓存命中</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>3级缓存</p>
<ul>
<li>本质上是实现了org.apache.ibatis.cache.Cache 接口的2级缓存，<ul>
<li>这个接口定义了缓存的基本操作：putObject, getObject, removeObject, clear, getSize, getReadWriteLock，</li>
</ul>
</li>
<li>值得注意的是RedisCache二级缓存响应的是redis库中的数据，返回的实体不能用’&#x3D;&#x3D;’判断，因为实体在内存中不是同一个<ul>
<li>查询结果会存在redis中用hash命名实体,key(时间戳+全路径实体名+sql):value(sql结果)</li>
</ul>
</li>
<li>Ehcache则可以用’&#x3D;&#x3D;’判断,获取到的二级缓存是同一个  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//mapper文件</span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.user.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span>  <span class="attr">type</span>=<span class="string">&quot;org.mybatis.caches.ehcache.EhcacheCache&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 或 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">&quot;org.mybatis.caches.redis.RedisCache&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// application文件 </span><br><span class="line"></span><br><span class="line">//开启缓存</span><br><span class="line">//mybatis-plus.configuration.cache-enabled=true</span><br><span class="line"></span><br><span class="line">//redis 配置</span><br><span class="line">//redis.host=localhost</span><br><span class="line">//redis.port=6379</span><br><span class="line">//redis.connectionTimeout=5000</span><br><span class="line">//redis.password=</span><br><span class="line">//redis.database=0</span><br><span class="line"></span><br><span class="line">//pom文件</span><br><span class="line">    <span class="comment">&lt;!-- mybatis cache --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.caches<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ehcache --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.ehcache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- redis --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- mybatis redis --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.caches<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-beta2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>测试响应  <figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">        List&lt;User&gt; userList;</span><br><span class="line">        List&lt;User&gt; userList<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">try</span>(SqlSession session = sqlSessionFactory.openSession())&#123;</span><br><span class="line">            UserMapper mapper =  session.getMapper(UserMapper.<span class="keyword">class</span>);</span><br><span class="line">            System.<span class="keyword">out</span>.println(<span class="string">&quot;查询时间1开始:&quot;</span>+System.currentTimeMillis());</span><br><span class="line">            userList = mapper.getUserList();</span><br><span class="line">            System.<span class="keyword">out</span>.println(<span class="string">&quot;查询时间1结束:&quot;</span>+System.currentTimeMillis());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>(SqlSession session<span class="number">2</span> = sqlSessionFactory.openSession())&#123;</span><br><span class="line">            UserMapper mapper =  session<span class="number">2</span>.getMapper(UserMapper.<span class="keyword">class</span>);</span><br><span class="line">            System.<span class="keyword">out</span>.println(<span class="string">&quot;查询时间2开始:&quot;</span>+System.currentTimeMillis());</span><br><span class="line">            userList<span class="number">2</span> = mapper.getUserList();</span><br><span class="line">            System.<span class="keyword">out</span>.println(<span class="string">&quot;查询时间2结束:&quot;</span>+System.currentTimeMillis());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (userList==userList<span class="number">2</span>)&#123;</span><br><span class="line">            System.<span class="keyword">out</span>.println(<span class="string">&quot;二级缓存命中&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//reids测试结果 </span></span><br><span class="line"><span class="comment">//查询时间1开始:1753351457712</span></span><br><span class="line"><span class="comment">//查询时间1结束:1753351457825</span></span><br><span class="line"><span class="comment">//查询时间2开始:1753351457828</span></span><br><span class="line"><span class="comment">//查询时间2结束:1753351457829</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Ehcache测试结果</span></span><br><span class="line"><span class="comment">//查询时间1开始:1753352167864</span></span><br><span class="line"><span class="comment">//查询时间1结束:1753352167972</span></span><br><span class="line"><span class="comment">//查询时间2开始:1753352167974</span></span><br><span class="line"><span class="comment">//查询时间2结束:1753352167974</span></span><br><span class="line"><span class="comment">//二级缓存命中</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://151459797.github.io/myblog/2025/11/06/%E5%90%8E%E7%AB%AF/JAVA/Hibernate/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/myblog/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/myblog/2025/11/06/%E5%90%8E%E7%AB%AF/JAVA/Hibernate/" class="post-title-link" itemprop="url">Hibernate</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-11-06 20:36:10 / 修改时间：09:12:29" itemprop="dateCreated datePublished" datetime="2025-11-06T20:36:10+08:00">2025-11-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/myblog/categories/%E5%90%8E%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">后端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Hibernate-一种ORM-Object-Relative-DateBase-Mapping-框架"><a href="#Hibernate-一种ORM-Object-Relative-DateBase-Mapping-框架" class="headerlink" title="Hibernate 一种ORM(Object_Relative DateBase-Mapping)框架"></a>Hibernate 一种ORM(Object_Relative DateBase-Mapping)框架</h1><ul>
<li>一、Hibernate 的基本概念<ul>
<li>1.1 核心思想<ul>
<li>Hibernate 是一个开源的对象关系映射（ORM）框架，用于将 Java 对象映射到关系型数据库。它通过提供透明的持久化机制，使开发者可以使用面向对象的方式操作数据库，而无需编写复杂的 SQL 语句。</li>
</ul>
</li>
<li>1.2 主要特性<ul>
<li>对象关系映射（ORM）：将 Java 类和数据库表进行映射，支持多种映射策略和注解。</li>
<li>数据库无关性：支持多种数据库（如 MySQL、Oracle、SQL Server 等），通过配置文件或注解实现数据库的无缝切换。</li>
<li>缓存机制：提供一级缓存（会话级别）和二级缓存（跨会话），提升查询性能。</li>
<li>事务管理：支持标准的 Java 事务 API（JTA）和本地事务管理。</li>
<li>延迟加载：按需加载关联对象，减少不必要的数据库访问。</li>
</ul>
</li>
</ul>
</li>
<li>二、Hibernate 的工作原理<ul>
<li>2.1 核心组件<ul>
<li>Configuration：加载配置文件（如 hibernate.cfg.xml）和映射文件，初始化会话工厂。</li>
<li>SessionFactory：会话工厂，线程安全，负责创建 Session 对象。</li>
<li>Session：与数据库的会话接口，用于执行 CRUD 操作，非线程安全。</li>
<li>Transaction：事务管理接口，用于控制事务的开始、提交和回滚。</li>
<li>Query：用于执行数据库查询，支持 HQL（Hibernate Query Language）和原生 SQL。</li>
</ul>
</li>
<li>2.2 工作流程<ul>
<li>配置加载：通过 Configuration 加载配置文件和映射文件。</li>
<li>创建会话工厂：使用 Configuration 构建 SessionFactory。</li>
<li>获取会话：通过 SessionFactory 创建 Session 对象。</li>
<li>事务管理：开启事务，执行数据库操作。</li>
<li>持久化操作：通过 Session 对象执行插入、更新、删除等操作。</li>
<li>提交事务：提交事务以确保数据一致性。</li>
<li>关闭资源：关闭 Session 和 SessionFactory。</li>
</ul>
</li>
</ul>
</li>
<li>三、Hibernate 的架构设计<ul>
<li>3.1 分层架构<ul>
<li>Hibernate 的架构分为以下层次：</li>
<li>Java 应用程序层：应用程序通过 Hibernate API 操作数据库。</li>
<li>Hibernate 框架层：包括核心组件如 SessionFactory、Session 和 Transaction。</li>
<li>后端 API 层：与 JDBC、JTA 和 JNDI 等 API 集成。</li>
<li>数据库层：与底层数据库交互。</li>
</ul>
</li>
<li>3.2 核心组件关系<ul>
<li>SessionFactory：线程安全的工厂类，负责创建 Session 对象。</li>
<li>Session：非线程安全的会话对象，用于执行数据库操作。</li>
<li>Transaction：事务管理接口，确保数据一致性。</li>
</ul>
</li>
</ul>
</li>
<li>四、Hibernate 的性能优化<ul>
<li>4.1 缓存优化<ul>
<li>一级缓存：默认开启，用于缓存当前会话加载的对象。</li>
<li>二级缓存：跨会话缓存，可配置第三方缓存实现（如 Ehcache）。</li>
</ul>
</li>
<li>4.2 查询优化<ul>
<li>HQL 查询：使用 HQL 优化复杂查询。</li>
<li>延迟加载：按需加载关联对象，减少不必要的数据库访问。</li>
</ul>
</li>
<li>4.3 批量操作<ul>
<li>通过设置 hibernate.jdbc.batch_size 配置批量操作，提高大批量数据处理的效率</li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://151459797.github.io/myblog/2025/11/06/%E5%90%8E%E7%AB%AF/JAVA/Mybatis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/myblog/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/myblog/2025/11/06/%E5%90%8E%E7%AB%AF/JAVA/Mybatis/" class="post-title-link" itemprop="url">Mybatis</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-11-06 20:36:10 / 修改时间：09:12:29" itemprop="dateCreated datePublished" datetime="2025-11-06T20:36:10+08:00">2025-11-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/myblog/categories/%E5%90%8E%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">后端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Mybits"><a href="#Mybits" class="headerlink" title="Mybits"></a>Mybits</h1><ul>
<li>介绍</li>
<li>1.MyBatis 简介<a target="_blank" rel="noopener" href="https://mybatis.net.cn/">官网</a><ul>
<li>MyBatis 是一款优秀的持久层(半ORM)框架，主要功能是根据命名空间找到对应的xml中的sql执行。可以根据实体生成对应的基本sql执行。</li>
<li>它支持定制化 SQL、存储过程以及高级映射。MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。MyBatis 可以使用简单的 XML 或注解来配置和映射原生信息，将接口和 Java 的 POJOs(Plain Ordinary Java Object，普通的 Java对象)映射成数据库中的记录。</li>
</ul>
</li>
<li>2.MyBatis 特点<ul>
<li>MyBatis 框架具有以下特点：<ul>
<li>简单易学：MyBatis 框架本身很小且简单，没有任何第三方依赖。最简单的安装只需要两个 jar 文件加上几个 SQL 映射文件。通过文档和源代码，可以比较全面地掌握它的设计思路和实现。</li>
<li>灵活：MyBatis 不会对应用程序或者数据库的现有设计强加任何影响。SQL 写在 XML 里，便于统一管理和优化。通过 SQL 语句可以满足操作数据库的所有需求。</li>
<li>解除 SQL 与程序代码的耦合：通过提供 DAO 层，将业务逻辑和数据访问逻辑分离，使系统的设计更清晰，更易维护，更易单元测试。SQL 和代码的分离，提高了可维护性。</li>
<li>提供映射标签：支持对象与数据库的 ORM 字段关系映射。</li>
<li>提供对象关系映射标签：支持对象关系组建维护。</li>
<li>提供 XML 标签：支持编写动态 SQL。</li>
</ul>
</li>
</ul>
</li>
<li>3.MyBatis 工作原理<ul>
<li>MyBatis 的工作原理可以分为以下几个步骤：<ul>
<li>加载配置并初始化：加载配置文件，将 SQL 的配置信息加载成为一个个 MappedStatement 对象（包括了传入参数映射配置、执行的 SQL 语句、结果映射配置），存储在内存中。</li>
<li>接收调用请求：调用 MyBatis 提供的 API，传入 SQL 的 ID 和传入参数对象，将请求传递给下层的请求处理层进行处理。</li>
<li>处理操作请求：</li>
<li>根据 SQL 的 ID 查找对应的 MappedStatement 对象。</li>
<li>根据传入参数对象解析 MappedStatement 对象，得到最终要执行的 SQL 和执行传入参数。</li>
<li>获取数据库连接，根据得到的最终 SQL 语句和执行传入参数到数据库执行，并得到执行结果。</li>
<li>根据 MappedStatement 对象中的结果映射配置对得到的执行结果进行转换处理，并得到最终的处理结果。</li>
<li>释放连接资源。</li>
<li>返回处理结果：将最终的处理结果返回。</li>
</ul>
</li>
<li>解析mapper.xml全过程<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Howinfun/p/12973902.html">解析映射sql文档参考</a><ul>
<li>1.参考代码<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">public</span> static <span class="type">void</span> main(String[] args) &#123;</span><br><span class="line">       SpringApplication.run(UserApplication.<span class="keyword">class</span>, args);</span><br><span class="line">       <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;UserApplication Start&quot;);</span><br><span class="line">       String resource = &quot;mybatis-config.xml&quot;;</span><br><span class="line">       try &#123;</span><br><span class="line">           InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">           <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;inputStream&quot;);</span><br><span class="line">           SqlSessionFactory sqlSessionFactory = <span class="built_in">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">           <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;sqlSessionFactory&quot;);</span><br><span class="line">           try(SqlSession <span class="keyword">session</span> = sqlSessionFactory.openSession())&#123;</span><br><span class="line">               <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;session&quot;);</span><br><span class="line">               UserMapper mapper =  <span class="keyword">session</span>.getMapper(UserMapper.<span class="keyword">class</span>);</span><br><span class="line">               List&lt;<span class="keyword">User</span>&gt; userList = mapper.getUserList();</span><br><span class="line">               <span class="keyword">for</span> (<span class="keyword">User</span> <span class="keyword">user</span> : userList) &#123;</span><br><span class="line">                   <span class="keyword">System</span>.<span class="keyword">out</span>.println(<span class="keyword">user</span>.getId()+&quot;:&quot;+<span class="keyword">user</span>.getUsername());</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; catch (<span class="keyword">Exception</span> e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;UserApplication Started&quot;);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li>
<li>2.首先需要加载配置打开连接。使用SqlSessionFactoryBuilder管理SqlSession工厂</li>
<li>3.在SqlSessionFactoryBuilder().build(inputStream);时，<ul>
<li>build函数中首先构建生成XMLMapperEntityResolver(实体解析器)用与XML实体解析器,MyBatis(dtd格式)的实体解析器。</li>
<li>再根据XMLMapperEntityResolver(实体解析器)生成XPathParser(路径解析器)</li>
<li>XPathParser用与将io流处理成Document实体保存在XPathParser(路径解析器中)</li>
<li>到此构建了XMLConfigBuilder实体，接下来会默认执行XMLConfigBuilder.parse()解析参数函数</li>
<li>其中有个parseConfiguration函数，会尝试负责读取和解析MyBatis配置文件中的各个元素，如properties、settings、typeAliases等  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 解析配置信息</span></span><br><span class="line"><span class="comment">* 该方法负责读取和解析MyBatis配置文件中的各个元素，如properties、settings、typeAliases等</span></span><br><span class="line"><span class="comment">* 每个元素的解析可能会涉及加载属性、设置别名、配置插件等操作</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> root 配置文件的根节点，通过它来访问配置文件中的各个元素</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">parseConfiguration</span><span class="params">(XNode root)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// issue #117 read properties first</span></span><br><span class="line">    <span class="comment">// 首先读取和解析properties元素，以加载自定义属性</span></span><br><span class="line">    propertiesElement(root.evalNode(<span class="string">&quot;properties&quot;</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 解析settings元素，获取配置属性</span></span><br><span class="line">    <span class="type">Properties</span> <span class="variable">settings</span> <span class="operator">=</span> settingsAsProperties(root.evalNode(<span class="string">&quot;settings&quot;</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据配置属性加载自定义的VFS实现</span></span><br><span class="line">    loadCustomVfs(settings);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据配置属性加载自定义的日志实现</span></span><br><span class="line">    loadCustomLogImpl(settings);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 解析typeAliases元素，注册类型别名</span></span><br><span class="line">    typeAliasesElement(root.evalNode(<span class="string">&quot;typeAliases&quot;</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 解析plugins元素，加载插件</span></span><br><span class="line">    pluginElement(root.evalNode(<span class="string">&quot;plugins&quot;</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 解析objectFactory元素，配置对象工厂</span></span><br><span class="line">    objectFactoryElement(root.evalNode(<span class="string">&quot;objectFactory&quot;</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 解析objectWrapperFactory元素，配置对象包装工厂</span></span><br><span class="line">    objectWrapperFactoryElement(root.evalNode(<span class="string">&quot;objectWrapperFactory&quot;</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 解析reflectorFactory元素，配置反射器工厂</span></span><br><span class="line">    reflectorFactoryElement(root.evalNode(<span class="string">&quot;reflectorFactory&quot;</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 解析settings属性，应用配置</span></span><br><span class="line">    settingsElement(settings);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// read it after objectFactory and objectWrapperFactory issue #631</span></span><br><span class="line">    <span class="comment">// 在解析了objectFactory和objectWrapperFactory之后解析environments元素，以配置环境</span></span><br><span class="line">    environmentsElement(root.evalNode(<span class="string">&quot;environments&quot;</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 解析databaseIdProvider元素，配置数据库ID提供者</span></span><br><span class="line">    databaseIdProviderElement(root.evalNode(<span class="string">&quot;databaseIdProvider&quot;</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 解析typeHandlers元素，注册类型处理器</span></span><br><span class="line">    typeHandlerElement(root.evalNode(<span class="string">&quot;typeHandlers&quot;</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 解析mappers元素，加载映射器</span></span><br><span class="line">    mapperElement(root.evalNode(<span class="string">&quot;mappers&quot;</span>));</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    <span class="comment">// 如果解析过程中发生错误，抛出BuilderException异常</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BuilderException</span>(<span class="string">&quot;Error parsing SQL Mapper Configuration. Cause: &quot;</span> + e, e);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>parseConfiguration中加载插件、日志、实体、工厂、配置、反射等</li>
<li>其中到最后面mapperElement加载sql的mappers映射器，加载Mapper映射顺序：<package>标签指定包名、resource属性指定XML文件路径 、url属性指定XML文件路径、class属性指定接口的完全限定名  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 解析Mapper配置元素</span></span><br><span class="line"><span class="comment">* 该方法负责处理与Mapper相关的配置，包括从XML配置文件或类中加载Mapper接口</span></span><br><span class="line"><span class="comment">* 它根据子元素的名称和属性，决定是通过资源文件、URL还是类名来加载Mapper配置</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> parent 包含Mapper配置的父节点如果为null，则不执行任何操作</span></span><br><span class="line"><span class="comment">* <span class="doctag">@throws</span> Exception 如果解析过程中遇到错误，则抛出异常</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">mapperElement</span><span class="params">(XNode parent)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (XNode child : parent.getChildren()) &#123;</span><br><span class="line">    <span class="comment">// 处理子元素为&quot;package&quot;的情况，表示批量加载一个包下的所有Mapper接口</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;package&quot;</span>.equals(child.getName())) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">mapperPackage</span> <span class="operator">=</span> child.getStringAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        configuration.addMappers(mapperPackage);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> child.getStringAttribute(<span class="string">&quot;resource&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> child.getStringAttribute(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">mapperClass</span> <span class="operator">=</span> child.getStringAttribute(<span class="string">&quot;class&quot;</span>);</span><br><span class="line">        <span class="comment">// 根据resource属性加载Mapper配置</span></span><br><span class="line">        <span class="keyword">if</span> (resource != <span class="literal">null</span> &amp;&amp; url == <span class="literal">null</span> &amp;&amp; mapperClass == <span class="literal">null</span>) &#123;</span><br><span class="line">        ErrorContext.instance().resource(resource);</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource)) &#123;</span><br><span class="line">            <span class="type">XMLMapperBuilder</span> <span class="variable">mapperParser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XMLMapperBuilder</span>(inputStream, configuration, resource,</span><br><span class="line">                configuration.getSqlFragments());</span><br><span class="line">            mapperParser.parse();</span><br><span class="line">        &#125;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">// 根据url属性加载Mapper配置</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (resource == <span class="literal">null</span> &amp;&amp; url != <span class="literal">null</span> &amp;&amp; mapperClass == <span class="literal">null</span>) &#123;</span><br><span class="line">        ErrorContext.instance().resource(url);</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getUrlAsStream(url)) &#123;</span><br><span class="line">            <span class="type">XMLMapperBuilder</span> <span class="variable">mapperParser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XMLMapperBuilder</span>(inputStream, configuration, url,</span><br><span class="line">                configuration.getSqlFragments());</span><br><span class="line">            mapperParser.parse();</span><br><span class="line">        &#125;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">// 根据class属性直接加载Mapper接口类</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (resource == <span class="literal">null</span> &amp;&amp; url == <span class="literal">null</span> &amp;&amp; mapperClass != <span class="literal">null</span>) &#123;</span><br><span class="line">        Class&lt;?&gt; mapperInterface = Resources.classForName(mapperClass);</span><br><span class="line">        configuration.addMapper(mapperInterface);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">// 报错情况：子元素同时指定了多个加载方式</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BuilderException</span>(</span><br><span class="line">            <span class="string">&quot;A mapper element may only specify a url, resource or class, but not more than one.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>接下来是resource、和url模式的会使用XMLMapperBuilder.parse()去添加映射器,而pack包形势的解析会在执行接口时解析<ul>
<li>二者解析方式不同，一种是代码中执行解析，一种是xml启动时解析</li>
<li>XML 注册：启动时一次性加载，首次执行快但启动稍慢</li>
<li>Package 注册：启动快，但首次执行需要解析 SQL</li>
</ul>
</li>
<li>XMLMapperBuilder.parse();去解析映射文件，并确保所有必要的映射器都已正确绑定和解析</li>
<li>再就是bindMapperForNamespace();根据命名空间将标签与sql绑定到映射器,会解析所有的   <figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">&lt;cache-ref&gt;</span>、<span class="symbol">&lt;cache&gt;</span>、<span class="symbol">&lt;parameterMap&gt;</span>、<span class="symbol">&lt;resultMap&gt;</span>、<span class="symbol">&lt;sql&gt;</span> 和 &lt;select|<span class="keyword">insert</span>|<span class="keyword">update</span>|<span class="keyword">delete</span>&gt; 标签</span><br></pre></td></tr></table></figure></li>
<li>但bindMapperForNamespace(),中 parsePendingStatements()才是真正解析sql的函数  <figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解析映射文件</span></span><br><span class="line"><span class="comment"> * 此方法主要用于解析映射文件，避免重复加载已解析的资源，并确保所有必要的映射器都已正确绑定和解析</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="type">void</span> <span class="title">parse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="comment">// 检查资源是否已加载，以避免重复解析</span></span><br><span class="line">     <span class="keyword">if</span> (!configuration.<span class="built_in">isResourceLoaded</span>(resource)) &#123;</span><br><span class="line">         <span class="comment">// 解析并处理mapper配置节点</span></span><br><span class="line">         <span class="built_in">configurationElement</span>(parser.<span class="built_in">evalNode</span>(<span class="string">&quot;/mapper&quot;</span>));</span><br><span class="line">         <span class="comment">// 将资源标记为已加载，防止重复解析</span></span><br><span class="line">         configuration.<span class="built_in">addLoadedResource</span>(resource);</span><br><span class="line">         <span class="comment">// 根据命名空间绑定映射器</span></span><br><span class="line">         <span class="built_in">bindMapperForNamespace</span>();</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 解析挂起的结果映射</span></span><br><span class="line">     <span class="built_in">parsePendingResultMaps</span>();</span><br><span class="line">     <span class="comment">// 解析挂起的缓存引用</span></span><br><span class="line">     <span class="built_in">parsePendingCacheRefs</span>();</span><br><span class="line">     <span class="comment">// 解析挂起的SQL语句</span></span><br><span class="line">     <span class="built_in">parsePendingStatements</span>();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解析配置元素，主要用于解析Mapper XML文件中的各种配置</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param context XNode对象，包含Mapper XML文件的节点信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="type">void</span> <span class="title">configurationElement</span><span class="params">(XNode context)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="comment">// 获取命名空间属性，这是Mapper配置中必须的属性</span></span><br><span class="line">         <span class="type">String</span> <span class="keyword">namespace</span> = context.<span class="built_in">getStringAttribute</span>(<span class="string">&quot;namespace&quot;</span>);</span><br><span class="line">         <span class="comment">// 如果命名空间为空，抛出异常，因为命名空间是Mapper配置中不可或缺的部分</span></span><br><span class="line">         <span class="keyword">if</span> (<span class="keyword">namespace</span> == null || <span class="keyword">namespace</span>.<span class="built_in">isEmpty</span>()) &#123;</span><br><span class="line">             <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">BuilderException</span>(<span class="string">&quot;Mapper&#x27;s namespace cannot be empty&quot;</span>);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="comment">// 设置当前的命名空间，以便后续的配置解析可以正确关联到对应的Mapper</span></span><br><span class="line">         builderAssistant.<span class="built_in">setCurrentNamespace</span>(<span class="keyword">namespace</span>);</span><br><span class="line">         <span class="comment">// 解析并处理cache-ref元素，如果存在的话</span></span><br><span class="line">         <span class="built_in">cacheRefElement</span>(context.<span class="built_in">evalNode</span>(<span class="string">&quot;cache-ref&quot;</span>));</span><br><span class="line">         <span class="comment">// 解析并处理cache元素，如果存在的话</span></span><br><span class="line">         <span class="built_in">cacheElement</span>(context.<span class="built_in">evalNode</span>(<span class="string">&quot;cache&quot;</span>));</span><br><span class="line">         <span class="comment">// 解析并处理所有的parameterMap元素</span></span><br><span class="line">         <span class="built_in">parameterMapElement</span>(context.<span class="built_in">evalNodes</span>(<span class="string">&quot;/mapper/parameterMap&quot;</span>));</span><br><span class="line">         <span class="comment">// 解析并处理所有的resultMap元素</span></span><br><span class="line">         <span class="built_in">resultMapElements</span>(context.<span class="built_in">evalNodes</span>(<span class="string">&quot;/mapper/resultMap&quot;</span>));</span><br><span class="line">         <span class="comment">// 解析并处理所有的sql元素</span></span><br><span class="line">         <span class="built_in">sqlElement</span>(context.<span class="built_in">evalNodes</span>(<span class="string">&quot;/mapper/sql&quot;</span>));</span><br><span class="line">         <span class="comment">// 根据上下文中的配置信息构建SQL语句</span></span><br><span class="line">         <span class="built_in">buildStatementFromContext</span>(context.<span class="built_in">evalNodes</span>(<span class="string">&quot;select|insert|update|delete&quot;</span>));</span><br><span class="line">     &#125; <span class="built_in">catch</span> (Exception e) &#123;</span><br><span class="line">         <span class="comment">// 如果解析过程中发生异常，抛出BuilderException，包含错误的XML位置和原始异常信息</span></span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">BuilderException</span>(<span class="string">&quot;Error parsing Mapper XML. The XML location is &#x27;&quot;</span> + resource + <span class="string">&quot;&#x27;. Cause: &quot;</span> + e, e);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解析挂起的SQL语句节点</span></span><br><span class="line"><span class="comment"> * 此方法尝试解析所有尚未完成的SQL语句节点，这些节点在配置中被标记为不完整</span></span><br><span class="line"><span class="comment"> * 它通过同步的方式遍历不完整的SQL语句集合，尝试解析每个语句</span></span><br><span class="line"><span class="comment"> * 如果语句解析成功，则从不完整集合中移除；如果解析失败则保留，留待以后处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="type">void</span> <span class="title">parsePendingStatements</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="comment">// 获取配置中所有不完整的SQL语句集合</span></span><br><span class="line">     Collection&lt;XMLStatementBuilder&gt; incompleteStatements = configuration.<span class="built_in">getIncompleteStatements</span>();</span><br><span class="line">     <span class="comment">// 对不完整SQL语句集合进行同步，防止多线程环境下的并发修改问题</span></span><br><span class="line">     <span class="built_in">synchronized</span> (incompleteStatements) &#123;</span><br><span class="line">         <span class="comment">// 使用迭代器遍历不完整的SQL语句集合</span></span><br><span class="line">         Iterator&lt;XMLStatementBuilder&gt; iter = incompleteStatements.<span class="built_in">iterator</span>();</span><br><span class="line">         <span class="keyword">while</span> (iter.<span class="built_in">hasNext</span>()) &#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">             <span class="comment">// 尝试解析当前SQL语句节点</span></span><br><span class="line">             iter.<span class="built_in">next</span>().<span class="built_in">parseStatementNode</span>();</span><br><span class="line">             <span class="comment">// 解析成功后，从集合中移除该SQL语句</span></span><br><span class="line">             iter.<span class="built_in">remove</span>();</span><br><span class="line">         &#125; <span class="built_in">catch</span> (IncompleteElementException e) &#123;</span><br><span class="line">             <span class="comment">// 当前SQL语句仍然缺少资源，跳过本次解析，留待以后处理</span></span><br><span class="line">         &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure></li>
<li>parsePendingStatements()中循环解析sql语句节点执行XMLStatementBuilder.parseStatementNode()解析</li>
<li>其中有转换前的校验和是否有缓存相关校验、确认无误后，使用langDriver.createSqlSource()转换成SqlSource对象</li>
<li>最终构建 将转换sql的相关信息:id、结果集、主键、builderAssistant.addMappedStatement构建 MappedStatement 并添加到配置中  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 解析 XML 中的语句节点（如 &lt;select&gt;, &lt;insert&gt;, &lt;update&gt;, &lt;delete&gt;）并构建对应的 MappedStatement 对象。</span></span><br><span class="line"><span class="comment">* 该方法会处理节点属性、包含的子节点（如 &lt;include&gt;, &lt;selectKey&gt;），并根据配置生成 SQL 相关信息。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">parseStatementNode</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 获取语句的 id 和 databaseId 属性</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> context.getStringAttribute(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">databaseId</span> <span class="operator">=</span> context.getStringAttribute(<span class="string">&quot;databaseId&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断当前数据库 ID 是否匹配，不匹配则跳过该语句</span></span><br><span class="line">    <span class="keyword">if</span> (!databaseIdMatchesCurrent(id, databaseId, <span class="built_in">this</span>.requiredDatabaseId)) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取节点名称并转换为对应的 SQL 命令类型</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">nodeName</span> <span class="operator">=</span> context.getNode().getNodeName();</span><br><span class="line">    <span class="type">SqlCommandType</span> <span class="variable">sqlCommandType</span> <span class="operator">=</span> SqlCommandType.valueOf(nodeName.toUpperCase(Locale.ENGLISH));</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isSelect</span> <span class="operator">=</span> sqlCommandType == SqlCommandType.SELECT;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解析缓存相关属性</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">flushCache</span> <span class="operator">=</span> context.getBooleanAttribute(<span class="string">&quot;flushCache&quot;</span>, !isSelect); <span class="comment">// 是否刷新缓存，默认为非查询语句自动刷新</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">useCache</span> <span class="operator">=</span> context.getBooleanAttribute(<span class="string">&quot;useCache&quot;</span>, isSelect);      <span class="comment">// 是否使用缓存，默认查询语句启用缓存</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">resultOrdered</span> <span class="operator">=</span> context.getBooleanAttribute(<span class="string">&quot;resultOrdered&quot;</span>, <span class="literal">false</span>); <span class="comment">// 结果是否有序</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理 &lt;include&gt; 标签，将引用的 SQL 片段展开到当前节点</span></span><br><span class="line">    <span class="type">XMLIncludeTransformer</span> <span class="variable">includeParser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XMLIncludeTransformer</span>(configuration, builderAssistant);</span><br><span class="line">    includeParser.applyIncludes(context.getNode());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解析参数类型</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">parameterType</span> <span class="operator">=</span> context.getStringAttribute(<span class="string">&quot;parameterType&quot;</span>);</span><br><span class="line">    Class&lt;?&gt; parameterTypeClass = resolveClass(parameterType);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解析语言驱动</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">lang</span> <span class="operator">=</span> context.getStringAttribute(<span class="string">&quot;lang&quot;</span>);</span><br><span class="line">    <span class="type">LanguageDriver</span> <span class="variable">langDriver</span> <span class="operator">=</span> getLanguageDriver(lang);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理 &lt;selectKey&gt; 标签并将其从当前节点中移除</span></span><br><span class="line">    processSelectKeyNodes(id, parameterTypeClass, langDriver);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理主键生成策略</span></span><br><span class="line">    KeyGenerator keyGenerator;</span><br><span class="line">    <span class="type">String</span> <span class="variable">keyStatementId</span> <span class="operator">=</span> id + SelectKeyGenerator.SELECT_KEY_SUFFIX;</span><br><span class="line">    keyStatementId = builderAssistant.applyCurrentNamespace(keyStatementId, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">if</span> (configuration.hasKeyGenerator(keyStatementId)) &#123;</span><br><span class="line">    keyGenerator = configuration.getKeyGenerator(keyStatementId);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    keyGenerator = context.getBooleanAttribute(<span class="string">&quot;useGeneratedKeys&quot;</span>,</span><br><span class="line">        configuration.isUseGeneratedKeys() &amp;&amp; SqlCommandType.INSERT.equals(sqlCommandType))</span><br><span class="line">            ? Jdbc3KeyGenerator.INSTANCE : NoKeyGenerator.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用语言驱动解析 SQL 源码</span></span><br><span class="line">    <span class="type">SqlSource</span> <span class="variable">sqlSource</span> <span class="operator">=</span> langDriver.createSqlSource(configuration, context, parameterTypeClass);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解析语句类型，默认为 PREPARED</span></span><br><span class="line">    <span class="type">StatementType</span> <span class="variable">statementType</span> <span class="operator">=</span> StatementType</span><br><span class="line">        .valueOf(context.getStringAttribute(<span class="string">&quot;statementType&quot;</span>, StatementType.PREPARED.toString()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解析 fetchSize 和 timeout 属性</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">fetchSize</span> <span class="operator">=</span> context.getIntAttribute(<span class="string">&quot;fetchSize&quot;</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">timeout</span> <span class="operator">=</span> context.getIntAttribute(<span class="string">&quot;timeout&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解析参数映射和结果映射相关属性</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">parameterMap</span> <span class="operator">=</span> context.getStringAttribute(<span class="string">&quot;parameterMap&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">resultType</span> <span class="operator">=</span> context.getStringAttribute(<span class="string">&quot;resultType&quot;</span>);</span><br><span class="line">    Class&lt;?&gt; resultTypeClass = resolveClass(resultType);</span><br><span class="line">    <span class="type">String</span> <span class="variable">resultMap</span> <span class="operator">=</span> context.getStringAttribute(<span class="string">&quot;resultMap&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果未指定 resultType 和 resultMap，则尝试从方法返回类型中获取</span></span><br><span class="line">    <span class="keyword">if</span> (resultTypeClass == <span class="literal">null</span> &amp;&amp; resultMap == <span class="literal">null</span>) &#123;</span><br><span class="line">        resultTypeClass = MapperAnnotationBuilder.getMethodReturnType(builderAssistant.getCurrentNamespace(), id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解析结果集类型</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">resultSetType</span> <span class="operator">=</span> context.getStringAttribute(<span class="string">&quot;resultSetType&quot;</span>);</span><br><span class="line">    <span class="type">ResultSetType</span> <span class="variable">resultSetTypeEnum</span> <span class="operator">=</span> resolveResultSetType(resultSetType);</span><br><span class="line">    <span class="keyword">if</span> (resultSetTypeEnum == <span class="literal">null</span>) &#123;</span><br><span class="line">        resultSetTypeEnum = configuration.getDefaultResultSetType();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 主键相关属性</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">keyProperty</span> <span class="operator">=</span> context.getStringAttribute(<span class="string">&quot;keyProperty&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">keyColumn</span> <span class="operator">=</span> context.getStringAttribute(<span class="string">&quot;keyColumn&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 结果集处理</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">resultSets</span> <span class="operator">=</span> context.getStringAttribute(<span class="string">&quot;resultSets&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 是否影响数据（用于标识语句是否修改数据库数据）</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">dirtySelect</span> <span class="operator">=</span> context.getBooleanAttribute(<span class="string">&quot;affectData&quot;</span>, Boolean.FALSE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最终构建 MappedStatement 并添加到配置中</span></span><br><span class="line">    builderAssistant.addMappedStatement(id, sqlSource, statementType, sqlCommandType, fetchSize, timeout, parameterMap,</span><br><span class="line">        parameterTypeClass, resultMap, resultTypeClass, resultSetTypeEnum, flushCache, useCache, resultOrdered,</span><br><span class="line">        keyGenerator, keyProperty, keyColumn, databaseId, langDriver, resultSets, dirtySelect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>SqlSource接口中存放org.apache.ibatis.mapping.BoundSql对象,BoundSql存放着sql语句、参数、映射、内置参数等</li>
<li>所以具体还要看org.apache.ibatis.scripting.LanguageDriver中createSqlSource接口怎么创建成BoundSql对象的。</li>
<li>而Mybatis默认使用org.apache.ibatis.scripting.xmltags.XMLLanguageDriver的lang驱动，</li>
<li>Mybatis中Lang驱动有2种<ul>
<li>XMLLanguageDriver 为 XML 语言驱动，实现了动态 SQL 的功能，也就是说可以利用 MyBatis 提供的 XML 标签（常用的、等标签）结合OGNL表达式语法来实现动态的条件判断。</li>
<li>RawLanguageDriver 表示仅支持静态 SQL 配置，不支持动态 SQL 功能。  <figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BoundSql</span> &#123;</span><br><span class="line">    <span class="comment">// Mapper配置解析后的sql语句</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="built_in">String</span> sql;</span><br><span class="line">    <span class="comment">// Mapper参数映射信息</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;ParameterMapping&gt; parameterMappings;</span><br><span class="line">    <span class="comment">// Mapper参数对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="built_in">Object</span> parameterObject;</span><br><span class="line">    <span class="comment">// 额外参数信息，包括&lt;bind&gt;标签绑定的参数，内置参数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;<span class="built_in">String</span>, <span class="built_in">Object</span>&gt; additionalParameters;</span><br><span class="line">    <span class="comment">// 参数对象对应的MetaObject对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MetaObject metaParameters;</span><br><span class="line">    <span class="comment">// ... 省略 get/set 和 构造函数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>其中可以看到2个createSqlSource函数实现<ul>
<li>第一个重载的 createSqlSource() 方法用于处理 XML 文件中配置的 SQL 信息，该方法中创建了一个 XMLScriptBuilder 对象，然后调用 XMLScriptBuilder 对象的 parseScriptNode() 方法将 SQL 资源转换为 SqlSource 对象。</li>
<li>第二个重载的 createSqlSource() 判断 SQL 配置是否以 script 标签开头。如果是，则以 XML 方式处理 Java 注解中配置的 SQL 信息；否则只是简单处理，</li>
</ul>
</li>
<li>解析还是得看最终执行得第一个重载函数，会先创建 XMLScriptBuilder 对象，接着调用 XMLScriptBuilder 对象 parseScriptNode() 方法解析SQL资源。  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* XML语言驱动器，用于处理XML格式的SQL映射文件</span></span><br><span class="line"><span class="comment">* 该类实现了LanguageDriver接口，提供了一系列方法来处理SQL的解析和参数处理</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XMLLanguageDriver</span> <span class="keyword">implements</span> <span class="title class_">LanguageDriver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 创建参数处理器</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> mappedStatement 映射语句对象，包含了一条SQL映射信息</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> parameterObject 传递给SQL语句的参数</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> boundSql 封装了SQL文本和参数的对象</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> 返回一个参数处理器，用于处理SQL语句中的参数</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ParameterHandler</span> <span class="title function_">createParameterHandler</span>(<span class="params"><span class="title class_">MappedStatement</span> mappedStatement, <span class="title class_">Object</span> parameterObject,</span></span><br><span class="line"><span class="params">        <span class="title class_">BoundSql</span> boundSql</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultParameterHandler</span>(mappedStatement, parameterObject, boundSql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 创建SQL源</span></span><br><span class="line"><span class="comment">    * 该方法解析XML格式的SQL脚本，并生成一个SqlSource对象</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> configuration 配置对象，包含了MyBatis的全局配置信息</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> script XML脚本节点，包含了SQL的定义</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> parameterType 传递给SQL语句的参数类型</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> 返回一个SQL源对象，用于生成最终的SQL语句</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">SqlSource</span> <span class="title function_">createSqlSource</span>(<span class="params"><span class="title class_">Configuration</span> configuration, <span class="title class_">XNode</span> script, <span class="title class_">Class</span>&lt;?&gt; parameterType</span>) &#123;</span><br><span class="line">        <span class="title class_">XMLScriptBuilder</span> builder = <span class="keyword">new</span> <span class="title class_">XMLScriptBuilder</span>(configuration, script, parameterType);</span><br><span class="line">        <span class="keyword">return</span> builder.<span class="title function_">parseScriptNode</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 创建SQL源</span></span><br><span class="line"><span class="comment">    * 该方法处理两种情况：一是带有&lt;script&gt;标签的字符串，二是不带有&lt;script&gt;标签的字符串</span></span><br><span class="line"><span class="comment">    * 对于带有&lt;script&gt;标签的字符串，将其作为XML处理；对于不带有&lt;script&gt;标签的字符串，直接解析</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> configuration 配置对象，包含了MyBatis的全局配置信息</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> script SQL脚本字符串</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> parameterType 传递给SQL语句的参数类型</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> 返回一个SQL源对象，用于生成最终的SQL语句</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">SqlSource</span> <span class="title function_">createSqlSource</span>(<span class="params"><span class="title class_">Configuration</span> configuration, <span class="title class_">String</span> script, <span class="title class_">Class</span>&lt;?&gt; parameterType</span>) &#123;</span><br><span class="line">        <span class="comment">// issue #3</span></span><br><span class="line">        <span class="keyword">if</span> (script.<span class="title function_">startsWith</span>(<span class="string">&quot;&lt;script&gt;&quot;</span>)) &#123;</span><br><span class="line">        <span class="title class_">XPathParser</span> parser = <span class="keyword">new</span> <span class="title class_">XPathParser</span>(script, <span class="literal">false</span>, configuration.<span class="title function_">getVariables</span>(), <span class="keyword">new</span> <span class="title class_">XMLMapperEntityResolver</span>());</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">createSqlSource</span>(configuration, parser.<span class="title function_">evalNode</span>(<span class="string">&quot;/script&quot;</span>), parameterType);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// issue #127</span></span><br><span class="line">        script = <span class="title class_">PropertyParser</span>.<span class="title function_">parse</span>(script, configuration.<span class="title function_">getVariables</span>());</span><br><span class="line">        <span class="title class_">TextSqlNode</span> textSqlNode = <span class="keyword">new</span> <span class="title class_">TextSqlNode</span>(script);</span><br><span class="line">        <span class="keyword">if</span> (textSqlNode.<span class="title function_">isDynamic</span>()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DynamicSqlSource</span>(configuration, textSqlNode);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RawSqlSource</span>(configuration, script, parameterType);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">            </span><br></pre></td></tr></table></figure></li>
<li>到了parseDynamicTags()这里就要开始解析sql了, 把XML中写的SQL语句解析成一个可以动态拼接的SQL结构。<ul>
<li>可以看到循环所有文本节点用于判断，</li>
<li>Node.CDATA_SECTION_NODE或Node.TEXT_NODE时如果是文本节点（TEXT 或 CDATA）<ul>
<li>把文本内容取出来（比如 id &#x3D; #{id}）。</li>
<li>创建一个 TextSqlNode。</li>
<li>textSqlNode.isDynamic()&#x2F;&#x2F;判断它是不是动态内容（比如有没有 #{}、${}）。<ul>
<li>如果是，说明是动态 SQL，添加到 contents，并标记整个 SQL 是动态的。</li>
<li>如果不是，就作为静态 SQL 添加进去。</li>
</ul>
</li>
</ul>
</li>
<li>Node.ELEMENT_NODE，XML 标签（ELEMENT_NODE）<ul>
<li>获取标签名（比如 if、foreach）。</li>
<li>根据标签名找到对应的处理器（NodeHandler）</li>
<li>用这个处理器去处理这个标签，把处理结果添加到 contents。</li>
<li>因为标签本身就是动态逻辑，所以直接标记整个 SQL 是动态的。</li>
</ul>
</li>
</ul>
</li>
<li>最后返回MixedSqlNode(contents)，最用 MixedSqlNode 整理保存 SQL 转换的所有 SqlNode。  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> SqlSource <span class="title function_">parseScriptNode</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">MixedSqlNode</span> <span class="variable">rootSqlNode</span> <span class="operator">=</span> parseDynamicTags(context);</span><br><span class="line">    SqlSource sqlSource;</span><br><span class="line">    <span class="comment">// 判断Mapper SQL配置中是否包含动态SQL元素，如果是创建DynamicSqlSource对象，否则创建RawSqlSource对象</span></span><br><span class="line">    <span class="keyword">if</span> (isDynamic) &#123;</span><br><span class="line">    sqlSource = <span class="keyword">new</span> <span class="title class_">DynamicSqlSource</span>(configuration, rootSqlNode);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    sqlSource = <span class="keyword">new</span> <span class="title class_">RawSqlSource</span>(configuration, rootSqlNode, parameterType);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sqlSource;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 解析动态标签</span></span><br><span class="line"><span class="comment">* 该方法用于解析SQL语句中的动态标签，如条件语句、循环语句等</span></span><br><span class="line"><span class="comment">* 它通过遍历给定节点的所有子节点，根据节点类型处理不同的情况</span></span><br><span class="line"><span class="comment">* 对于文本节点，判断其是否为动态SQL的一部分；对于元素节点，使用相应的处理器进行处理</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> node XML节点，代表SQL语句的一部分</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 返回一个MixedSqlNode，它包含了静态和动态SQL部分的解析结果</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">protected</span> MixedSqlNode <span class="title function_">parseDynamicTags</span><span class="params">(XNode node)</span> &#123;</span><br><span class="line">    <span class="comment">// 存储解析后的SQL节点</span></span><br><span class="line">    List&lt;SqlNode&gt; contents = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 获取当前节点下所有的子节点</span></span><br><span class="line">    <span class="type">NodeList</span> <span class="variable">children</span> <span class="operator">=</span> node.getNode().getChildNodes();</span><br><span class="line">    <span class="comment">// 遍历所有子节点</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; children.getLength(); i++) &#123;</span><br><span class="line">        <span class="comment">// 创建一个新的XNode包装当前子节点</span></span><br><span class="line">        <span class="type">XNode</span> <span class="variable">child</span> <span class="operator">=</span> node.newXNode(children.item(i));</span><br><span class="line">        <span class="comment">// 判断当前子节点的类型</span></span><br><span class="line">        <span class="keyword">if</span> (child.getNode().getNodeType() == Node.CDATA_SECTION_NODE || child.getNode().getNodeType() == Node.TEXT_NODE) &#123;</span><br><span class="line">        <span class="comment">// 获取文本节点的内容</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> child.getStringBody(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="comment">// 创建一个TextSqlNode对象，用于解析动态SQL</span></span><br><span class="line">        <span class="type">TextSqlNode</span> <span class="variable">textSqlNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TextSqlNode</span>(data);</span><br><span class="line">        <span class="comment">// 判断该文本节点是否为动态SQL的一部分</span></span><br><span class="line">        <span class="keyword">if</span> (textSqlNode.isDynamic()) &#123;</span><br><span class="line">            <span class="comment">// 如果是动态SQL，添加到contents中，并设置isDynamic为true</span></span><br><span class="line">            contents.add(textSqlNode);</span><br><span class="line">            isDynamic = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 如果不是动态SQL，作为静态文本添加到contents中</span></span><br><span class="line">            contents.add(<span class="keyword">new</span> <span class="title class_">StaticTextSqlNode</span>(data));</span><br><span class="line">        &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (child.getNode().getNodeType() == Node.ELEMENT_NODE) &#123; <span class="comment">// issue #628</span></span><br><span class="line">        <span class="comment">// 获取元素节点的名称</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">nodeName</span> <span class="operator">=</span> child.getNode().getNodeName();</span><br><span class="line">        <span class="comment">// 根据节点名称获取相应的处理器</span></span><br><span class="line">        <span class="type">NodeHandler</span> <span class="variable">handler</span> <span class="operator">=</span> nodeHandlerMap.get(nodeName);</span><br><span class="line">        <span class="comment">// 如果没有找到对应的处理器，抛出异常</span></span><br><span class="line">        <span class="keyword">if</span> (handler == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BuilderException</span>(<span class="string">&quot;Unknown element &lt;&quot;</span> + nodeName + <span class="string">&quot;&gt; in SQL statement.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 使用处理器处理当前节点，并将结果添加到contents中</span></span><br><span class="line">        handler.handleNode(child, contents);</span><br><span class="line">        <span class="comment">// 设置isDynamic为true，表示SQL中包含动态部分</span></span><br><span class="line">        isDynamic = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 返回包含所有解析结果的MixedSqlNode对象</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MixedSqlNode</span>(contents);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>当 &lt;select|insert|update|delete&gt; 标签解析完后，会利用工具类 MapperBuilderAssistant 的 addMappedStatement() 方法来将解析的所有信息封装为对应的 MappedStatement 对象，然后注册到 Configuration 中。</li>
<li>XML 文件解析完后，XMLMapperBuilder#parse() 方法会调用 Configuration#addLoadedResource() 方法将 XML 文件的资源路径注册到Configuration 中。</li>
<li>最后，在 XMLMapperBuilder#parse() 方法中还会调用 XMLMapperBuilder#bindMapperForNamespace() 方法，将 Mapper 接口注册到 Configuration 中。接口注册底层是使用 MapperRegistry 类，这个类会保存着所有 Mapper 接口的注册信息。在注册时，会为 Mapper 接口创建对应的 MapperFactoryBean；当执行 Mapper 时，可以根据当前 SqlSession 创建 Mapper 接口对应的 MapperProxy 代理实例。</li>
<li>XMLMapperBuilder#bindMapperForNamespace() 方法在 Mapper 接口注册后，还会创建 MapperAnnotationBuilder 对象来解析 Mapper 接口带 SQL 注解方法，也是生成对应的 MappedStatement 然后注册到 Configuration 中。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>4.MyBatis 架构<ul>
<li>MyBatis 的功能架构可以分为三层：<ul>
<li>API 接口层：提供给外部使用的接口 API，开发人员通过这些本地 API 来操纵数据库。接口层一接收到调用请求就会调用数据处理层来完成具体的数据处理。</li>
<li>数据处理层：负责具体的 SQL 查找、SQL 解析、SQL 执行和执行结果映射处理等。它主要的目的是根据调用的请求完成一次数据库操作。</li>
<li>基础支撑层：负责最基础的功能支撑，包括连接管理、事务管理、配置加载和缓存处理，这些都是共用的东西，将他们抽取出来作为最基础的组件。为上层的数据处理层提供最基础的支撑。</li>
</ul>
</li>
</ul>
</li>
<li>5.MyBatis 核心组件<ul>
<li>MyBatis 的核心组件包括：<ul>
<li>SqlSessionFactory：通过 MyBatis 环境等配置信息构造 SqlSessionFactory（会话工厂）。</li>
<li>SqlSession：通过会话工厂创建 SqlSession（会话），对数据库进行增删改查操作。</li>
<li>Executor：MyBatis 底层自定义了 Executor 执行器接口来具体操作数据库，Executor 接口有两个实现，一个基本执行器（默认），一个是缓存执行器，SqlSession 底层是通过 Executor 接口操作数据库。</li>
<li>MappedStatement：MyBatis 的一个底层封装对象，它包装了 MyBatis 配置信息与 sql 映射信息等。mapper.xml 中的 insert&#x2F;select&#x2F;update&#x2F;delete 标签对应一个 MappedStatement 对象。标签的 id 就是 MappedStatement 的 id。</li>
<li>SqlSource：负责根据用户传递的 parameterObject，动态地生成 SQL 语句，将信息封装到 BoundSql 对象中，并返回。</li>
<li>BoundSql：表示动态生成的 SQL 语句以及相应的参数信息。</li>
</ul>
</li>
</ul>
</li>
<li>6.MyBatis 配置文件<ul>
<li>MyBatis 的配置文件包括：<ul>
<li>mybatis-config.xml：MyBatis 的主配置文件，配置了全局配置文件，配置了 MyBatis 的运行环境等信息。</li>
<li>Mapper.xml：SQL 的映射文件，配置了操作数据库的 SQL 语句，此文件需在 mybatis-config.xml 中加载。</li>
</ul>
</li>
</ul>
</li>
<li>7.MyBatis 动态 SQL<ul>
<li>MyBatis 提供了动态 SQL 功能，可以使用强大的动态 SQL 来改进 SQL 语句条件连接的痛苦。动态 SQL 元素对于任何使用过 JSTL 或者类似于 XML 之类的文本处理器的人来说，都是非常熟悉的。在上一版本中，需要了解和学习非常多的元素，但在 MyBatis 3 中有了许多的改进，现在只剩下差不多二分之一的元素。MyBatis 使用了基于强大的 OGNL 表达式来消除了大部分元素。</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/myblog/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/myblog/">1</a><span class="page-number current">2</span><a class="page-number" href="/myblog/page/3/">3</a><a class="extend next" rel="next" href="/myblog/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/myblog/archives">
          <span class="site-state-item-count">28</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/myblog/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/myblog/lib/anime.min.js"></script>
  <script src="/myblog/lib/pjax/pjax.min.js"></script>
  <script src="/myblog/lib/velocity/velocity.min.js"></script>
  <script src="/myblog/lib/velocity/velocity.ui.min.js"></script>

<script src="/myblog/js/utils.js"></script>

<script src="/myblog/js/motion.js"></script>


<script src="/myblog/js/schemes/muse.js"></script>


<script src="/myblog/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  
<script src="/myblog/js/local-search.js"></script>













    <div id="pjax">
  

  

    </div>
</body>
</html>
